<?xml version="1.0" encoding="utf-8" ?>
<!--
 - Copyright (C) 2019-2020 ConnectorIO Sp. z o.o.
 -
 - Licensed under the Apache License, Version 2.0 (the "License");
 - you may not use this file except in compliance with the License.
 - You may obtain a copy of the License at
 -
 -     http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS,
 - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 - See the License for the specific language governing permissions and
 - limitations under the License.
 -
 - SPDX-License-Identifier: Apache-2.0
 -->
<features xmlns="http://karaf.apache.org/xmlns/features/v1.6.0" name="co7io-features-plc4x-${project.version}">

  <repository>mvn:org.connectorio.binding.features/base/${project.version}/xml/features</repository>

  <!--
  This feature descriptor is mixture of both - co7io plc4x shared and plc4x related dependencies, ideally we will move
  back plc4x related ones to project.
  -->

  <feature name="co7io-binding-plc4x-shared" description="ConnectorIO PLC4X Binding Shared" version="${project.version}">
    <feature>co7io-binding-base</feature>
    <feature>plc4x-api</feature>

    <bundle>mvn:org.connectorio.binding.plc4x/shared/${project.version}</bundle>
  </feature>

  <!-- plc4x start -->

  <feature name="plc4x-api" description="PLC4X API and SPI" version="${plc4x.version}">
    <bundle>mvn:org.apache.commons/commons-lang3/3.9</bundle>
    <bundle>mvn:commons-codec/commons-codec/1.15</bundle>

    <bundle>mvn:org.apache.plc4x/plc4j-api/${plc4x.version}</bundle>
    <bundle>mvn:org.apache.plc4x/plc4j-spi/${plc4x.version}</bundle>
    <bundle>mvn:org.apache.plc4x/plc4j-osgi/${plc4x.version}</bundle>

    <bundle>mvn:io.vavr/vavr/0.10.2</bundle>
    <bundle>mvn:io.vavr/vavr-match/0.10.2</bundle>
  </feature>

  <feature name="plc4x-shared-deps" version="${plc4x.version}" hidden="true">
    <feature>plc4x-api</feature>
    <feature>plc4x-netty</feature>

    <bundle>mvn:com.github.jinahya/bit-io/1.4.3</bundle>

    <!-- lets place all of commons here ..
    <bundle>mvn:commons-io/commons-io/2.6</bundle>
    -->
    <bundle>mvn:commons-beanutils/commons-beanutils/1.9.4</bundle>
    <bundle>mvn:org.apache.commons/commons-text/1.8</bundle>
    <bundle>mvn:org.apache.commons/commons-configuration2/2.7</bundle>
    <bundle>mvn:commons-collections/commons-collections/3.2.2</bundle>
    <bundle>mvn:commons-logging/commons-logging/1.2</bundle>
  </feature>

  <feature name="plc4x-netty" version="${plc4x.version}" hidden="true">
    <bundle>mvn:io.netty/netty-codec/4.1.47.Final</bundle>
    <bundle>mvn:commons-codec/commons-codec/1.12</bundle>
    <bundle>mvn:io.netty/netty-common/4.1.47.Final</bundle>
    <bundle>mvn:io.netty/netty-transport/4.1.47.Final</bundle>
    <bundle>mvn:io.netty/netty-resolver/4.1.47.Final</bundle>
    <bundle>mvn:io.netty/netty-buffer/4.1.47.Final</bundle>
  </feature>

  <feature name="plc4x-netty-serial" version="${plc4x.version}" hidden="true">
    <feature>plc4x-netty</feature>
    <bundle>mvn:com.neuronrobotics/nrjavaserial/3.14.0</bundle>
    <bundle>mvn:io.netty/netty-transport-rxtx/4.1.47.Final</bundle>
  </feature>

  <feature name="plc4x-transport-tcp">
    <feature>plc4x-shared-deps</feature>
    <bundle>mvn:org.apache.plc4x/plc4j-transport-tcp/0.8.0-SNAPSHOT</bundle>
  </feature>

  <feature name="plc4x-transport-serial">
    <feature>plc4x-netty-serial</feature>
    <feature>plc4x-shared-deps</feature>
    <bundle>mvn:com.fazecast/jSerialComm/2.5.1</bundle>
    <bundle>mvn:org.apache.plc4x/plc4j-transport-serial/0.8.0-SNAPSHOT</bundle>
  </feature>

  <feature name="plc4x-transport-socketcan">
    <feature prerequisite="true">wrap</feature>
    <feature>plc4x-shared-deps</feature>
    <bundle>wrap:mvn:tel.schich/javacan/2.3.0</bundle>
    <bundle>mvn:org.apache.plc4x/plc4j-transport-socketcan/0.8.0-SNAPSHOT</bundle>
  </feature>

  <feature name="plc4x-ads-driver" description="Apache PLC4X - Beckhoff ADS driver" version="${plc4x.version}">
    <details>Implementation of protocol for Beckhoff twincat devices.</details>
    <feature prerequisite="true">wrap</feature>
    <feature>scr</feature>
    <feature>plc4x-api</feature>
    <feature>plc4x-transport-tcp</feature>
    <feature>plc4x-transport-serial</feature>

    <bundle>mvn:org.apache.plc4x/plc4j-driver-ads/${plc4x.version}</bundle>
    <bundle>wrap:mvn:com.github.snksoft/crc/1.0.1</bundle>
  </feature>

  <feature name="plc4x-can-driver" description="Apache PLC4X - CAN driver" version="${plc4x.version}">
    <details>Implementation of CAN related protocols.</details>
    <feature>scr</feature>
    <feature>plc4x-api</feature>
    <feature>plc4x-transport-socketcan</feature>

    <bundle>mvn:org.apache.plc4x.sandbox/test-java-can-driver/${plc4x.version}</bundle>
  </feature>

  <feature name="plc4x-eip-driver" description="Apache PLC4X - Ethernet/IP driver" version="${plc4x.version}">
    <details>Implementation of Ethernet/IP protocol.</details>
    <feature prerequisite="true">wrap</feature>
    <feature>scr</feature>
    <feature>plc4x-api</feature>
    <feature>plc4x-transport-tcp</feature>

    <bundle>mvn:org.apache.plc4x/plc4j-driver-eip/${plc4x.version}</bundle>
  </feature>

  <feature name="plc4x-modbus-driver" description="Apache PLC4X - Modbus driver" version="${plc4x.version}">
    <details>Implementation of Modbus protocol.</details>
    <feature prerequisite="true">wrap</feature>
    <feature>scr</feature>
    <feature>plc4x-api</feature>
    <feature>plc4x-transport-tcp</feature>
    <feature>plc4x-transport-serial</feature>

    <bundle>mvn:org.apache.plc4x/plc4j-driver-modbus/${plc4x.version}</bundle>
  </feature>

  <feature name="plc4x-s7-driver" description="Apache PLC4X - Siemens S7 driver" version="${plc4x.version}">
    <details>Implementation of Siemens S7 protocol.</details>
    <feature>scr</feature>
    <feature>plc4x-api</feature>
    <feature>plc4x-transport-tcp</feature>

    <bundle>mvn:org.apache.plc4x/plc4j-driver-s7/${plc4x.version}</bundle>
  </feature>

</features>
